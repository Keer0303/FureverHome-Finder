{"ast":null,"code":"export default {\n  name: \"Adopt\",\n  data() {\n    return {\n      tableData: [],\n      // All data\n      pageNum: 1,\n      // Current page number\n      pageSize: 10,\n      // Number of items per page\n      total: 0,\n      animalId: null,\n      status: null,\n      // 初始化 status 变量\n      form: {},\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      ids: [],\n      name: null,\n      animalData: [],\n      rules: {\n        name: [{\n          required: true,\n          message: 'Please enter pet name',\n          trigger: 'blur'\n        }],\n        status: [{\n          required: true,\n          message: 'Please enter pet status',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    this.load(1);\n    this.loadAnimal();\n  },\n  methods: {\n    loadAnimal() {\n      this.$request.get('/adopt/selectAll').then(res => {\n        if (res.code === '200') {\n          this.animalData = res.data;\n          // console.log(this.animalData); // 打印 animalData 以确认数据正确加载\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error('Request failed', error);\n        this.$message.error('Failed to load animal data.');\n      });\n    },\n    handleAdd() {\n      // Add data\n      this.form = {}; // Clear data when adding new data\n      this.fromVisible = true; // Open the modal\n    },\n\n    handleEdit(row) {\n      // Edit data\n      this.form = JSON.parse(JSON.stringify(row)); // Deep copy data to form object\n      this.fromVisible = true; // Open the modal\n    },\n\n    save() {\n      // Logic triggered by save button, triggers add or update\n      this.$request({\n        url: this.form.id ? '/adopt/update' : '/adopt/add',\n        method: this.form.id ? 'PUT' : 'POST',\n        data: this.form\n      }).then(res => {\n        if (res.code === '200') {\n          // Indicates successful save\n          this.$message.success('Saved successfully');\n          this.load(1);\n          this.fromVisible = false;\n        } else {\n          this.$message.error(res.msg); // Show error message\n        }\n      });\n    },\n\n    GiveUp(row) {\n      this.$confirm('Are you sure you want to give up the adoption? Giving up the adoption means you will no longer be the potential adopter for this animal. If you have any concerns or need assistance, please contact our support team.', 'Confirm', {\n        type: \"warning\"\n      }).then(response => {\n        this.form = JSON.parse(JSON.stringify(row));\n        this.form.status = 'GiveUp Adoption';\n        this.save();\n      }).catch(() => {});\n    },\n    handleSelectionChange(rows) {\n      // Currently selected rows\n      this.ids = rows.map(v => v.id); //  [1,2]\n    },\n\n    delBatch() {\n      // Delete selected items\n      if (!this.ids.length) {\n        this.$message.warning('Please select data');\n        return;\n      }\n      this.$confirm('Are you sure you want to delete these data?', 'Confirm Delete', {\n        type: \"warning\"\n      }).then(response => {\n        this.$request.delete('/adopt/delete/batch', {\n          data: this.ids\n        }).then(res => {\n          if (res.code === '200') {\n            // Indicates successful operation\n            this.$message.success('Operation successful');\n            this.load(1);\n          } else {\n            this.$message.error(res.msg); // Show error message\n          }\n        });\n      }).catch(() => {});\n    },\n    load(pageNum) {\n      // Pagination query\n      if (pageNum) this.pageNum = pageNum;\n      this.$request.get('/adopt/selectPage', {\n        params: {\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          status: this.status,\n          // 确保 status 变量被正确传递\n          name: this.name // 传递 name 参数\n        }\n      }).then(res => {\n        this.tableData = res.data?.list;\n        this.total = res.data?.total;\n        console.log(this.tableData);\n      });\n    },\n    reset() {\n      this.status = null; // Reset status variable\n      this.name = null; // Reset name variable\n      this.load(1);\n    },\n    handleCurrentChange(pageNum) {\n      this.load(pageNum);\n    }\n  }\n};","map":{"version":3,"names":["name","data","tableData","pageNum","pageSize","total","animalId","status","form","user","JSON","parse","localStorage","getItem","ids","animalData","rules","required","message","trigger","created","load","loadAnimal","methods","$request","get","then","res","code","$message","error","msg","catch","console","handleAdd","fromVisible","handleEdit","row","stringify","save","url","id","method","success","GiveUp","$confirm","type","response","handleSelectionChange","rows","map","v","delBatch","length","warning","delete","params","list","log","reset","handleCurrentChange"],"sources":["src/views/manager/Adopt.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"search\">\r\n      <el-input\r\n          placeholder=\"Search By Name\"\r\n          style=\"width: 150px; margin-right: 10px;\"\r\n          v-model=\"name\">\r\n      </el-input>\r\n      <el-input\r\n          placeholder=\"Search By Status\"\r\n          style=\"width: 150px; margin-right: 10px;\"\r\n          v-model=\"status\">\r\n      </el-input>\r\n      <el-button\r\n          type=\"info\"\r\n          plain\r\n          style=\"margin-left: 10px\"\r\n          @click=\"load(1)\">\r\n        Search\r\n      </el-button>\r\n      <el-button\r\n          type=\"warning\"\r\n          plain\r\n          style=\"margin-left: 10px\"\r\n          @click=\"reset\">\r\n        Reset\r\n      </el-button>\r\n    </div>\r\n\r\n    <div class=\"table\">\r\n      <el-table\r\n          :data=\"tableData\"\r\n          stripe\r\n          @selection-change=\"handleSelectionChange\">\r\n        <el-table-column\r\n            type=\"selection\"\r\n            width=\"55\"\r\n            align=\"center\">\r\n        </el-table-column>\r\n        <el-table-column\r\n            prop=\"id\"\r\n            label=\"ID\"\r\n            width=\"80\"\r\n            align=\"center\"\r\n            sortable>\r\n        </el-table-column>\r\n        <el-table-column\r\n            prop=\"animalImg\"\r\n            label=\"Image\"\r\n            show-overflow-tooltip>\r\n          <template v-slot=\"scope\">\r\n            <div style=\"display: flex; align-items: center\">\r\n              <el-image\r\n                  style=\"width: 40px; height: 40px; border-radius: 50%\"\r\n                  v-if=\"scope.row.animalImg\"\r\n                  :src=\"scope.row.animalImg\"\r\n                  :preview-src-list=\"[scope.row.animalImg]\">\r\n              </el-image>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column\r\n            prop=\"animalName\"\r\n            label=\"Name\"\r\n            show-overflow-tooltip>\r\n        </el-table-column>\r\n        <el-table-column\r\n            prop=\"userName\"\r\n            label=\"Adopter\"\r\n            show-overflow-tooltip>\r\n        </el-table-column>\r\n        <el-table-column\r\n            prop=\"time\"\r\n            label=\"Adopt Time\">\r\n        </el-table-column>\r\n        <el-table-column\r\n            prop=\"status\"\r\n            label=\"Adoption Status\">\r\n        </el-table-column>\r\n        <el-table-column\r\n            label=\"Actions\"\r\n            width=\"180\"\r\n            align=\"center\">\r\n          <template v-slot=\"scope\">\r\n            <!-- 只有非管理员用户才显示这个按钮 -->\r\n            <el-button\r\n                v-if=\"user.role !== 'ADMIN'\"\r\n                plain\r\n                type=\"danger\"\r\n                size=\"mini\"\r\n                :disabled=\"scope.row.status === 'GiveUp Adoption'\"\r\n                @click=\"GiveUp(scope.row)\">\r\n              Give Up Adoption\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div class=\"pagination\">\r\n        <el-pagination\r\n            background\r\n            @current-change=\"handleCurrentChange\"\r\n            :current-page=\"pageNum\"\r\n            :page-sizes=\"[5, 10, 20]\"\r\n            :page-size=\"pageSize\"\r\n            layout=\"total, prev, pager, next\"\r\n            :total=\"total\">\r\n        </el-pagination>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Adopt\",\r\n  data() {\r\n    return {\r\n      tableData: [],  // All data\r\n      pageNum: 1,   // Current page number\r\n      pageSize: 10,  // Number of items per page\r\n      total: 0,\r\n      animalId: null,\r\n      status: null,  // 初始化 status 变量\r\n      form: {},\r\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\r\n      ids: [],\r\n      name: null,\r\n      animalData:[],\r\n      rules: {\r\n        name: [\r\n          {required: true, message: 'Please enter pet name', trigger: 'blur'},\r\n        ],\r\n        status: [\r\n          {required: true, message: 'Please enter pet status', trigger: 'blur'},\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.load(1);\r\n    this.loadAnimal();\r\n  },\r\n  methods: {\r\n    loadAnimal() {\r\n      this.$request.get('/adopt/selectAll').then(res => {\r\n        if (res.code === '200') {\r\n          this.animalData = res.data;\r\n          // console.log(this.animalData); // 打印 animalData 以确认数据正确加载\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      }).catch(error => {\r\n        console.error('Request failed', error);\r\n        this.$message.error('Failed to load animal data.');\r\n      });\r\n    },\r\n    handleAdd() {   // Add data\r\n      this.form = {};  // Clear data when adding new data\r\n      this.fromVisible = true;   // Open the modal\r\n    },\r\n    handleEdit(row) {   // Edit data\r\n      this.form = JSON.parse(JSON.stringify(row));  // Deep copy data to form object\r\n      this.fromVisible = true;   // Open the modal\r\n    },\r\n    save() {   // Logic triggered by save button, triggers add or update\r\n      this.$request({\r\n        url: this.form.id ? '/adopt/update' : '/adopt/add',\r\n        method: this.form.id ? 'PUT' : 'POST',\r\n        data: this.form\r\n      }).then(res => {\r\n        if (res.code === '200') {  // Indicates successful save\r\n          this.$message.success('Saved successfully');\r\n          this.load(1);\r\n          this.fromVisible = false;\r\n        } else {\r\n          this.$message.error(res.msg);  // Show error message\r\n        }\r\n      })\r\n    },\r\n    GiveUp(row) {\r\n      this.$confirm('Are you sure you want to give up the adoption? Giving up the adoption means you will no longer be the potential adopter for this animal. If you have any concerns or need assistance, please contact our support team.', 'Confirm', {type: \"warning\"}).then(response => {\r\n        this.form = JSON.parse(JSON.stringify(row));\r\n        this.form.status = 'GiveUp Adoption';\r\n        this.save();\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    handleSelectionChange(rows) {   // Currently selected rows\r\n      this.ids = rows.map(v => v.id);   //  [1,2]\r\n    },\r\n    delBatch() {   // Delete selected items\r\n      if (!this.ids.length) {\r\n        this.$message.warning('Please select data');\r\n        return;\r\n      }\r\n      this.$confirm('Are you sure you want to delete these data?', 'Confirm Delete', {type: \"warning\"}).then(response => {\r\n        this.$request.delete('/adopt/delete/batch', {data: this.ids}).then(res => {\r\n          if (res.code === '200') {   // Indicates successful operation\r\n            this.$message.success('Operation successful');\r\n            this.load(1);\r\n          } else {\r\n            this.$message.error(res.msg);  // Show error message\r\n          }\r\n        })\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    load(pageNum) {  // Pagination query\r\n      if (pageNum) this.pageNum = pageNum;\r\n      this.$request.get('/adopt/selectPage', {\r\n        params: {\r\n          pageNum: this.pageNum,\r\n          pageSize: this.pageSize,\r\n          status: this.status,  // 确保 status 变量被正确传递\r\n          name: this.name, // 传递 name 参数\r\n        }\r\n      }).then(res => {\r\n        this.tableData = res.data?.list;\r\n        this.total = res.data?.total;\r\n        console.log(this.tableData);\r\n      })\r\n    },\r\n    reset() {\r\n      this.status = null;  // Reset status variable\r\n      this.name = null; // Reset name variable\r\n      this.load(1);\r\n    },\r\n    handleCurrentChange(pageNum) {\r\n      this.load(pageNum);\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}