{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: \"Home\",\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem(\"xm-user\") || \"{}\"),\n      animalData: [],\n      dialogVisible: false,\n      adoptionFormVisible: false,\n      selectedAnimal: {},\n      adoptionForm: {\n        reason: \"\"\n      },\n      formLabelWidth: \"120px\",\n      dataProtectionDialogVisible: true // Initially show the data protection dialog\n    };\n  },\n\n  computed: {\n    filteredAnimalData() {\n      return this.animalData.filter(item => item.status !== \"Adopted\");\n    }\n  },\n  created() {\n    this.checkDataProtectionConsent();\n    this.loadAnimal();\n  },\n  methods: {\n    // Check if the user has already consented to data protection\n    checkDataProtectionConsent() {\n      const consentGiven = localStorage.getItem(\"dataProtectionConsent\");\n      if (consentGiven) {\n        this.dataProtectionDialogVisible = false;\n      }\n    },\n    loadAnimal() {\n      this.$request.get(\"/animal/selectAll\").then(res => {\n        if (res.code === \"200\") {\n          this.animalData = res.data;\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error(\"Error loading animal data:\", error);\n        this.$message.error(\"An error occurred while loading animal data\");\n      });\n    },\n    openAdoptionForm(animal) {\n      this.selectedAnimal = animal;\n      this.adoptionFormVisible = true;\n    },\n    submitAdoptionForm() {\n      if (!this.adoptionForm.reason) {\n        this.$message.error(\"Please fill in the reason for adoption\");\n        return;\n      }\n      let applicationData = {\n        userId: this.user.id,\n        animalId: this.selectedAnimal.id,\n        name: this.user.name,\n        email: this.user.email,\n        phone: this.user.phone,\n        reason: this.adoptionForm.reason,\n        status: \"Pending\"\n      };\n      this.$request.post(\"/application/add\", applicationData).then(res => {\n        if (res.code === \"200\") {\n          this.$message.success(\"Adoption request sent\");\n          this.adoptionFormVisible = false;\n          this.resetAdoptionForm();\n          this.loadAnimal(); // Reload animal data to reflect the status change\n        } else {\n          this.$message.error(\"Unable to submit the application. Please complete your email address.\");\n        }\n      }).catch(error => {\n        console.error(\"Error sending adoption request:\", error.response || error.message || error);\n        this.$message.error(\"An error occurred while sending adoption request\");\n      });\n    },\n    resetAdoptionForm() {\n      this.adoptionForm = {\n        reason: \"\"\n      };\n    },\n    showDetails(animal) {\n      this.selectedAnimal = animal;\n      this.dialogVisible = true;\n    },\n    handleClose(done) {\n      this.dialogVisible = false;\n      done();\n    },\n    acceptDataProtection() {\n      this.dataProtectionDialogVisible = false;\n      localStorage.setItem(\"dataProtectionConsent\", \"true\"); // Store consent state\n    },\n\n    declineDataProtection() {\n      this.$message.error(\"You must agree to the data protection regulation to use the website.\");\n      this.logoutUser(); // Call logout method\n    },\n\n    handleDataProtectionClose(done) {\n      this.declineDataProtection();\n      done();\n    },\n    logoutUser() {\n      // Clear user data and navigate to Login page\n      localStorage.removeItem(\"xm-user\"); // Remove user data from localStorage\n      localStorage.removeItem(\"dataProtectionConsent\"); // Remove consent\n      this.$router.push({\n        name: \"Login\"\n      }); // Redirect to Login.vue\n    }\n  }\n};","map":{"version":3,"names":["name","data","user","JSON","parse","localStorage","getItem","animalData","dialogVisible","adoptionFormVisible","selectedAnimal","adoptionForm","reason","formLabelWidth","dataProtectionDialogVisible","computed","filteredAnimalData","filter","item","status","created","checkDataProtectionConsent","loadAnimal","methods","consentGiven","$request","get","then","res","code","$message","error","msg","catch","console","openAdoptionForm","animal","submitAdoptionForm","applicationData","userId","id","animalId","email","phone","post","success","resetAdoptionForm","response","message","showDetails","handleClose","done","acceptDataProtection","setItem","declineDataProtection","logoutUser","handleDataProtectionClose","removeItem","$router","push"],"sources":["src/views/manager/Home.vue"],"sourcesContent":["<template>\n  <div>\n    <!-- Data Protection Regulation Dialog -->\n    <el-dialog\n        :visible.sync=\"dataProtectionDialogVisible\"\n        title=\"Data Protection & Privacy Notice\"\n        width=\"60%\"\n        :before-close=\"handleDataProtectionClose\"\n    >\n      <div class=\"data-protection-content\">\n        <h3>Welcome to Furever Home Finder!</h3>\n        <p>\n          At Furever Home Finder, we are committed to safeguarding your privacy\n          and ensuring the security of your personal data. Our website adheres\n          to the highest standards of data protection and complies with the\n          General Data Protection Regulation (GDPR).\n        </p>\n\n        <div class=\"data-protection-details\">\n          <h4>What We Collect</h4>\n          <ul>\n            <li>\n              Personal identification information (Name, email address, etc.)\n            </li>\n            <li>Contact information (Phone number, address)</li>\n            <li>Usage data and website interactions</li>\n          </ul>\n\n          <h4>Why We Collect</h4>\n          <ul>\n            <li>To provide personalized user experiences</li>\n            <li>To improve our services and website functionality</li>\n            <li>To process adoption applications efficiently</li>\n          </ul>\n\n          <h4>Your Rights</h4>\n          <ul>\n            <li>Right to access your personal data</li>\n            <li>Right to rectify incorrect data</li>\n            <li>Right to erasure ('right to be forgotten')</li>\n            <li>Right to restrict processing of your data</li>\n            <li>Right to data portability</li>\n            <li>Right to object to data processing</li>\n          </ul>\n\n          <p>\n            By clicking \"Agree,\" you consent to our use of your data in\n            accordance with our\n            <router-link to=\"/Privacy\">Privacy Policy</router-link>. Your\n            information is stored securely and will not be shared with third\n            parties without your explicit consent.\n          </p>\n\n          <p>\n            For more information on how we protect your data, please visit our\n            <router-link to=\"/Privacy\">Privacy Policy</router-link> page.\n          </p>\n        </div>\n      </div>\n\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"declineDataProtection\">Decline</el-button>\n        <el-button type=\"primary\" @click=\"acceptDataProtection\">Agree</el-button>\n      </div>\n    </el-dialog>\n\n    <div class=\"card header-card\" v-if=\"!dataProtectionDialogVisible\">\n      Hello, {{ user?.name }}, Welcome to Furever Home Finder!\n      <!-- <el-button type=\"primary\" @click=\"showNotices\" class=\"notice-button\">Notice</el-button> -->\n    </div>\n\n    <div class=\"content\" v-if=\"!dataProtectionDialogVisible\">\n      <div class=\"card pet-info-card\">\n        <!-- Pet Info -->\n        <div class=\"pet-info-title\">Adopt love, one paw at a time.</div>\n        <el-row>\n          <el-col :span=\"6\" v-for=\"item in filteredAnimalData\" :key=\"item.id\">\n            <div class=\"card pet-card\">\n              <img :src=\"item.img\" alt=\"\" class=\"pet-image\" />\n              <div class=\"pet-name\">\n                {{ item.name }} <br />（{{ item.species }}）\n              </div>\n              <div class=\"pet-details\">\n                Sex：{{ item.sex }}， Age：{{ item.age }}\n              </div>\n              <div class=\"pet-status\">\n                Status：<span class=\"status-text\">{{ item.status }}</span>\n              </div>\n              <div class=\"about-me\">\n                About me：<br /><span class=\"about-me-text\">{{ item.descr }}</span>\n              </div>\n              <div>\n                <el-button\n                    type=\"success\"\n                    size=\"mini\"\n                    class=\"adopt-button\"\n                    :disabled=\"\n                    item.status === 'Adopted' ||\n                    item.status === 'In Process' ||\n                    user.role === 'ADMIN'\n                  \"\n                    @click=\"openAdoptionForm(item)\"\n                >Apply to Adopt</el-button\n                >\n                <el-button\n                    type=\"primary\"\n                    size=\"mini\"\n                    class=\"details-button\"\n                    @click=\"showDetails(item)\"\n                >View Details</el-button\n                >\n              </div>\n            </div>\n          </el-col>\n        </el-row>\n      </div>\n    </div>\n\n    <!-- 申请领养表单对话框 -->\n    <el-dialog\n        :visible.sync=\"adoptionFormVisible\"\n        width=\"40%\"\n        title=\"Adoption Application\"\n    >\n      <el-form :model=\"adoptionForm\" ref=\"adoptionForm\">\n        <el-form-item label=\"Reason\" :label-width=\"formLabelWidth\">\n          <el-input\n              type=\"textarea\"\n              :rows=\"4\"\n              v-model=\"adoptionForm.reason\"\n          ></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"adoptionFormVisible = false\">Cancel</el-button>\n        <el-button type=\"primary\" @click=\"submitAdoptionForm\">Submit</el-button>\n      </div>\n    </el-dialog>\n\n    <!-- 详情对话框 -->\n    <el-dialog\n        :visible.sync=\"dialogVisible\"\n        width=\"30%\"\n        :before-close=\"handleClose\"\n    >\n      <span slot=\"title\">{{ selectedAnimal.name }}'s Details</span>\n      <div>\n        <img :src=\"selectedAnimal.img\" alt=\"\" class=\"details-image\" />\n        <div class=\"details-name\">{{ selectedAnimal.name }}</div>\n        <div class=\"details-info\">Species: {{ selectedAnimal.species }}</div>\n        <div class=\"details-info\">Sex: {{ selectedAnimal.sex }}</div>\n        <div class=\"details-info\">Age: {{ selectedAnimal.age }}</div>\n        <div class=\"details-info\">\n          Status:\n          <span\n              :style=\"{\n              color: selectedAnimal.status === 'Adopted' ? '#7d3d0c' : '#000',\n            }\"\n          >{{ selectedAnimal.status }}</span\n          >\n        </div>\n        <div class=\"details-about\">\n          About me: {{ selectedAnimal.descr }}\n        </div>\n      </div>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">Close</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"Home\",\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem(\"xm-user\") || \"{}\"),\n      animalData: [],\n      dialogVisible: false,\n      adoptionFormVisible: false,\n      selectedAnimal: {},\n      adoptionForm: {\n        reason: \"\",\n      },\n      formLabelWidth: \"120px\",\n      dataProtectionDialogVisible: true, // Initially show the data protection dialog\n    };\n  },\n  computed: {\n    filteredAnimalData() {\n      return this.animalData.filter((item) => item.status !== \"Adopted\");\n    },\n  },\n  created() {\n    this.checkDataProtectionConsent();\n    this.loadAnimal();\n  },\n  methods: {\n    // Check if the user has already consented to data protection\n    checkDataProtectionConsent() {\n      const consentGiven = localStorage.getItem(\"dataProtectionConsent\");\n      if (consentGiven) {\n        this.dataProtectionDialogVisible = false;\n      }\n    },\n\n    loadAnimal() {\n      this.$request\n          .get(\"/animal/selectAll\")\n          .then((res) => {\n            if (res.code === \"200\") {\n              this.animalData = res.data;\n            } else {\n              this.$message.error(res.msg);\n            }\n          })\n          .catch((error) => {\n            console.error(\"Error loading animal data:\", error);\n            this.$message.error(\n                \"An error occurred while loading animal data\"\n            );\n          });\n    },\n    openAdoptionForm(animal) {\n      this.selectedAnimal = animal;\n      this.adoptionFormVisible = true;\n    },\n    submitAdoptionForm() {\n      if (!this.adoptionForm.reason) {\n        this.$message.error(\"Please fill in the reason for adoption\");\n        return;\n      }\n\n      let applicationData = {\n        userId: this.user.id,\n        animalId: this.selectedAnimal.id,\n        name: this.user.name,\n        email: this.user.email,\n        phone: this.user.phone,\n        reason: this.adoptionForm.reason,\n        status: \"Pending\",\n      };\n\n      this.$request\n          .post(\"/application/add\", applicationData)\n          .then((res) => {\n            if (res.code === \"200\") {\n              this.$message.success(\"Adoption request sent\");\n              this.adoptionFormVisible = false;\n              this.resetAdoptionForm();\n              this.loadAnimal(); // Reload animal data to reflect the status change\n            } else {\n              this.$message.error(\n                  \"Unable to submit the application. Please complete your email address.\"\n              );\n            }\n          })\n          .catch((error) => {\n            console.error(\n                \"Error sending adoption request:\",\n                error.response || error.message || error\n            );\n            this.$message.error(\n                \"An error occurred while sending adoption request\"\n            );\n          });\n    },\n    resetAdoptionForm() {\n      this.adoptionForm = {\n        reason: \"\",\n      };\n    },\n    showDetails(animal) {\n      this.selectedAnimal = animal;\n      this.dialogVisible = true;\n    },\n    handleClose(done) {\n      this.dialogVisible = false;\n      done();\n    },\n    acceptDataProtection() {\n      this.dataProtectionDialogVisible = false;\n      localStorage.setItem(\"dataProtectionConsent\", \"true\"); // Store consent state\n    },\n    declineDataProtection() {\n      this.$message.error(\n          \"You must agree to the data protection regulation to use the website.\"\n      );\n      this.logoutUser(); // Call logout method\n    },\n    handleDataProtectionClose(done) {\n      this.declineDataProtection();\n      done();\n    },\n    logoutUser() {\n      // Clear user data and navigate to Login page\n      localStorage.removeItem(\"xm-user\"); // Remove user data from localStorage\n      localStorage.removeItem(\"dataProtectionConsent\"); // Remove consent\n      this.$router.push({ name: \"Login\" }); // Redirect to Login.vue\n    },\n  },\n};\n</script>\n\n<style scoped>\n.el-col-6 {\n  padding: 10px;\n}\n\n.container {\n  display: flex;\n  flex-direction: row;\n}\n\n.header-card {\n  padding: 15px;\n  font-size: 24px;\n  font-weight: bold;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.content {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n}\n\n.pet-info-card {\n  width: 100%;\n  padding: 15px;\n}\n\n.pet-info-title {\n  margin-bottom: 20px;\n  font-size: 20px;\n  font-weight: bold;\n  color: #1f618d;\n}\n\n.pet-card {\n  background-color: #f8f4e8;\n  text-align: center;\n}\n\n.pet-image {\n  width: 80px;\n  height: 80px;\n  border-radius: 50%;\n  object-fit: cover;\n}\n\n.pet-name {\n  font-weight: bold;\n  color: #817a70;\n  margin-top: 5px;\n}\n\n.pet-details,\n.pet-status {\n  color: #575353;\n  font-size: 13px;\n  margin-top: 5px;\n}\n\n.pet-status {\n  color: #7d3d0c;\n}\n\n.status-text {\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: normal;\n}\n\n.about-me {\n  margin-top: 15px;\n  color: #4b4949;\n  text-align: left;\n}\n\n.about-me-text {\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: normal;\n}\n\n.adopt-button,\n.details-button {\n  margin-top: 20px;\n}\n\n.details-image {\n  width: 300px;\n  height: 300px;\n  display: block;\n  margin: 0 auto;\n  object-fit: contain;\n}\n\n.details-name {\n  text-align: center;\n  margin-top: 10px;\n  font-weight: bold;\n  font-size: 18px;\n}\n\n.details-info,\n.details-about {\n  margin-top: 10px;\n}\n\n.data-protection-content {\n  font-size: 16px;\n  line-height: 1.5;\n  color: #333;\n}\n\n.data-protection-content h3 {\n  color: #2c3e50;\n  margin-bottom: 20px;\n}\n\n.data-protection-content h4 {\n  color: #2c3e50;\n  margin-top: 15px;\n  margin-bottom: 10px;\n}\n\n.data-protection-content ul {\n  padding-left: 20px;\n  margin-bottom: 20px;\n}\n\n.data-protection-content ul li {\n  list-style-type: disc;\n  margin-bottom: 5px;\n}\n\n.data-protection-content a {\n  color: #3498db;\n  text-decoration: none;\n}\n\n.data-protection-content a:hover {\n  text-decoration: underline;\n}\n</style>\n"],"mappings":";AA6KA;EACAA,IAAA;EACAC,KAAA;IACA;MACAC,IAAA,EAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;MACAC,UAAA;MACAC,aAAA;MACAC,mBAAA;MACAC,cAAA;MACAC,YAAA;QACAC,MAAA;MACA;MACAC,cAAA;MACAC,2BAAA;IACA;EACA;;EACAC,QAAA;IACAC,mBAAA;MACA,YAAAT,UAAA,CAAAU,MAAA,CAAAC,IAAA,IAAAA,IAAA,CAAAC,MAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,0BAAA;IACA,KAAAC,UAAA;EACA;EACAC,OAAA;IACA;IACAF,2BAAA;MACA,MAAAG,YAAA,GAAAnB,YAAA,CAAAC,OAAA;MACA,IAAAkB,YAAA;QACA,KAAAV,2BAAA;MACA;IACA;IAEAQ,WAAA;MACA,KAAAG,QAAA,CACAC,GAAA,sBACAC,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAtB,UAAA,GAAAqB,GAAA,CAAA3B,IAAA;QACA;UACA,KAAA6B,QAAA,CAAAC,KAAA,CAAAH,GAAA,CAAAI,GAAA;QACA;MACA,GACAC,KAAA,CAAAF,KAAA;QACAG,OAAA,CAAAH,KAAA,+BAAAA,KAAA;QACA,KAAAD,QAAA,CAAAC,KAAA,CACA,6CACA;MACA;IACA;IACAI,iBAAAC,MAAA;MACA,KAAA1B,cAAA,GAAA0B,MAAA;MACA,KAAA3B,mBAAA;IACA;IACA4B,mBAAA;MACA,UAAA1B,YAAA,CAAAC,MAAA;QACA,KAAAkB,QAAA,CAAAC,KAAA;QACA;MACA;MAEA,IAAAO,eAAA;QACAC,MAAA,OAAArC,IAAA,CAAAsC,EAAA;QACAC,QAAA,OAAA/B,cAAA,CAAA8B,EAAA;QACAxC,IAAA,OAAAE,IAAA,CAAAF,IAAA;QACA0C,KAAA,OAAAxC,IAAA,CAAAwC,KAAA;QACAC,KAAA,OAAAzC,IAAA,CAAAyC,KAAA;QACA/B,MAAA,OAAAD,YAAA,CAAAC,MAAA;QACAO,MAAA;MACA;MAEA,KAAAM,QAAA,CACAmB,IAAA,qBAAAN,eAAA,EACAX,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAC,QAAA,CAAAe,OAAA;UACA,KAAApC,mBAAA;UACA,KAAAqC,iBAAA;UACA,KAAAxB,UAAA;QACA;UACA,KAAAQ,QAAA,CAAAC,KAAA,CACA,uEACA;QACA;MACA,GACAE,KAAA,CAAAF,KAAA;QACAG,OAAA,CAAAH,KAAA,CACA,mCACAA,KAAA,CAAAgB,QAAA,IAAAhB,KAAA,CAAAiB,OAAA,IAAAjB,KACA;QACA,KAAAD,QAAA,CAAAC,KAAA,CACA,kDACA;MACA;IACA;IACAe,kBAAA;MACA,KAAAnC,YAAA;QACAC,MAAA;MACA;IACA;IACAqC,YAAAb,MAAA;MACA,KAAA1B,cAAA,GAAA0B,MAAA;MACA,KAAA5B,aAAA;IACA;IACA0C,YAAAC,IAAA;MACA,KAAA3C,aAAA;MACA2C,IAAA;IACA;IACAC,qBAAA;MACA,KAAAtC,2BAAA;MACAT,YAAA,CAAAgD,OAAA;IACA;;IACAC,sBAAA;MACA,KAAAxB,QAAA,CAAAC,KAAA,CACA,sEACA;MACA,KAAAwB,UAAA;IACA;;IACAC,0BAAAL,IAAA;MACA,KAAAG,qBAAA;MACAH,IAAA;IACA;IACAI,WAAA;MACA;MACAlD,YAAA,CAAAoD,UAAA;MACApD,YAAA,CAAAoD,UAAA;MACA,KAAAC,OAAA,CAAAC,IAAA;QAAA3D,IAAA;MAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}