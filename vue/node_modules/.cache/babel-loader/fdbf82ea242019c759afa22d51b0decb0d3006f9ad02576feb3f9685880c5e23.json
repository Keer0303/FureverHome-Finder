{"ast":null,"code":"export default {\n  name: \"Adopt\",\n  data() {\n    return {\n      tableData: [],\n      pageNum: 1,\n      pageSize: 10,\n      total: 0,\n      animalId: null,\n      adopterId: null,\n      status: null,\n      form: {},\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      ids: [],\n      animalData: [],\n      adopterData: [],\n      searchQuery: '',\n      adopterQuery: '' // 添加收养人搜索输入框的绑定值\n    };\n  },\n\n  created() {\n    this.load(1);\n    this.loadAnimal();\n    this.loadAdopter();\n  },\n  computed: {\n    filteredAnimalData() {\n      if (!this.searchQuery) {\n        return [];\n      }\n      return this.animalData.filter(item => item.name.toLowerCase().includes(this.searchQuery.toLowerCase()));\n    },\n    filteredAdopterData() {\n      if (!this.adopterQuery) {\n        return [];\n      }\n      return this.adopterData.filter(item => item.name.toLowerCase().includes(this.adopterQuery.toLowerCase()));\n    }\n  },\n  methods: {\n    loadAnimal() {\n      this.$request.get('/adopt/selectAnimal').then(res => {\n        if (res.code === '200') {\n          this.animalData = res.data;\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error('Request failed', error);\n        this.$message.error('Failed to load animal data.');\n      });\n    },\n    loadAdopter() {\n      this.$request.get('/adopt/selectAdopter').then(res => {\n        if (res.code === '200') {\n          this.adopterData = res.data;\n          console.log(this.adopterData); // 打印 adopterData 以确认数据正确加载\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error('Request failed', error);\n        this.$message.error('Failed to load adopter data.');\n      });\n    },\n    save() {\n      this.$request({\n        url: this.form.id ? '/adopt/update' : '/adopt/add',\n        method: this.form.id ? 'PUT' : 'POST',\n        data: this.form\n      }).then(res => {\n        if (res.code === '200') {\n          this.$message.success('Saved successfully');\n          this.load(1);\n          this.fromVisible = false;\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    },\n    GiveUp(row) {\n      this.$confirm('Are you sure you want to give up the adoption? Giving up the adoption means you will no longer be the potential adopter for this animal. If you have any concerns or need assistance, please contact our support team.', 'Confirm', {\n        type: \"warning\"\n      }).then(response => {\n        this.form = JSON.parse(JSON.stringify(row));\n        this.form.status = 'GiveUp Adoption';\n        this.save();\n      }).catch(() => {});\n    },\n    handleSelectionChange(rows) {\n      this.ids = rows.map(v => v.id);\n    },\n    delBatch() {\n      if (!this.ids.length) {\n        this.$message.warning('Please select data');\n        return;\n      }\n      this.$confirm('Are you sure you want to delete these data?', 'Confirm Delete', {\n        type: \"warning\"\n      }).then(response => {\n        this.$request.delete('/adopt/delete/batch', {\n          data: this.ids\n        }).then(res => {\n          if (res.code === '200') {\n            this.$message.success('Operation successful');\n            this.load(1);\n          } else {\n            this.$message.error(res.msg);\n          }\n        });\n      }).catch(() => {});\n    },\n    load(pageNum) {\n      if (pageNum) this.pageNum = pageNum;\n      this.$request.get('/adopt/selectPage', {\n        params: {\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          status: this.status,\n          animalId: this.animalId,\n          userId: this.adopterId\n        }\n      }).then(res => {\n        this.tableData = res.data?.list;\n        this.total = res.data?.total;\n      });\n    },\n    reset() {\n      this.status = null;\n      this.animalId = null;\n      this.adopterId = null;\n      this.searchQuery = '';\n      this.adopterQuery = '';\n      this.load(1);\n    },\n    handleCurrentChange(pageNum) {\n      this.load(pageNum);\n    },\n    handleSearch() {\n      // 在这里可以处理额外的搜索逻辑，例如记录搜索关键词或其他操作\n      // 当前示例中没有具体操作，因为过滤逻辑在 computed 属性中\n    },\n    handleAdopterSearch() {\n      // 这里处理额外的收养人搜索逻辑\n    },\n    selectAnimal(id) {\n      this.animalId = id;\n      this.searchQuery = this.animalData.find(item => item.id === id).name;\n    },\n    selectAdopter(id) {\n      this.adopterId = id;\n      this.adopterQuery = this.adopterData.find(item => item.id === id).name;\n    }\n  }\n};","map":{"version":3,"names":["name","data","tableData","pageNum","pageSize","total","animalId","adopterId","status","form","user","JSON","parse","localStorage","getItem","ids","animalData","adopterData","searchQuery","adopterQuery","created","load","loadAnimal","loadAdopter","computed","filteredAnimalData","filter","item","toLowerCase","includes","filteredAdopterData","methods","$request","get","then","res","code","$message","error","msg","catch","console","log","save","url","id","method","success","fromVisible","GiveUp","row","$confirm","type","response","stringify","handleSelectionChange","rows","map","v","delBatch","length","warning","delete","params","userId","list","reset","handleCurrentChange","handleSearch","handleAdopterSearch","selectAnimal","find","selectAdopter"],"sources":["src/views/manager/Adopt.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    \r\n    <div class=\"search\">\r\n      <!-- 搜索框 -->\r\n      <el-input v-model=\"searchQuery\" placeholder=\"Search By Animal Name\" style=\"width: 200px\"  @input=\"handleSearch\"></el-input>\r\n      <ul v-if=\"filteredAnimalData.length > 0\" class=\"search-results\">\r\n        <li v-for=\"item in filteredAnimalData\" :key=\"item.id\" @click=\"selectAnimal(item.id)\">\r\n          {{ item.name }}\r\n        </li>\r\n      </ul>\r\n\r\n      <!-- 收养人搜索框 -->\r\n      <el-input v-model=\"adopterQuery\" placeholder=\"Search By Adopter\" style=\"width: 200px; margin-left: 5px\" @input=\"handleAdopterSearch\" v-if=\"user.role === 'ADMIN'\"></el-input>\r\n      <ul v-if=\"filteredAdopterData.length > 0\" class=\"search-results\">\r\n        <li v-for=\"item in filteredAdopterData\" :key=\"item.id\" @click=\"selectAdopter(item.id)\">\r\n          {{ item.name }}\r\n        </li>\r\n      </ul>\r\n\r\n      <!-- 状态选择框 -->\r\n      <el-select v-model=\"status\" placeholder=\"Search By Status\" style=\"width: 200px; margin-left: 5px\">\r\n        <el-option label=\"Adopted\" value=\"Adopted\"></el-option>\r\n        <el-option label=\"In Process\" value=\"In Process\"></el-option>\r\n<!--        <el-option label=\"GiveUp Adoption\" value=\"GiveUp Adoption\"></el-option>-->\r\n      </el-select>\r\n\r\n      <el-button type=\"info\" plain style=\"margin-left: 10px\" @click=\"load(1)\">Search</el-button>\r\n      <el-button type=\"warning\" plain style=\"margin-left: 10px\" @click=\"reset\">Reset</el-button>\r\n    </div>\r\n\r\n    <div class=\"table\">\r\n      <el-table :data=\"tableData\" stripe @selection-change=\"handleSelectionChange\">\r\n        <el-table-column type=\"selection\" width=\"55\" align=\"center\"></el-table-column>\r\n        <el-table-column prop=\"id\" label=\"ID\" width=\"80\" align=\"center\" sortable></el-table-column>\r\n        <el-table-column prop=\"animalImg\" label=\"Image\" show-overflow-tooltip>\r\n          <template v-slot=\"scope\">\r\n            <div style=\"display: flex; align-items: center\">\r\n              <el-image style=\"width: 40px; height: 40px; border-radius: 50%\" v-if=\"scope.row.animalImg\"\r\n                        :src=\"scope.row.animalImg\" :preview-src-list=\"[scope.row.animalImg]\"></el-image>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"animalName\" label=\"Name\" show-overflow-tooltip></el-table-column>\r\n        <el-table-column prop=\"userName\" label=\"Adopter\" show-overflow-tooltip></el-table-column>\r\n        <el-table-column prop=\"time\" label=\"Adopt Time\"></el-table-column>\r\n        <el-table-column prop=\"status\" label=\"Adoption Status\"></el-table-column>\r\n        <el-table-column label=\"Actions\" width=\"180\" align=\"center\">\r\n          <template v-slot=\"scope\">\r\n            <el-button v-if=\"user.role !== 'ADMIN'\" plain type=\"danger\" size=\"mini\" :disabled=\"scope.row.status === 'GiveUp Adoption'\" @click=\"GiveUp(scope.row)\">Give Up Adoption</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div class=\"pagination\">\r\n        <el-pagination\r\n            background\r\n            @current-change=\"handleCurrentChange\"\r\n            :current-page=\"pageNum\"\r\n            :page-sizes=\"[5, 10, 20]\"\r\n            :page-size=\"pageSize\"\r\n            layout=\"total, prev, pager, next\"\r\n            :total=\"total\">\r\n        </el-pagination>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Adopt\",\r\n  data() {\r\n    return {\r\n      tableData: [],\r\n      pageNum: 1,\r\n      pageSize: 10,\r\n      total: 0,\r\n      animalId: null,\r\n      adopterId: null,\r\n      status: null,\r\n      form: {},\r\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\r\n      ids: [],\r\n      animalData: [],\r\n      adopterData: [],\r\n      searchQuery: '',\r\n      adopterQuery: ''  // 添加收养人搜索输入框的绑定值\r\n    }\r\n  },\r\n  created() {\r\n    this.load(1);\r\n    this.loadAnimal();\r\n    this.loadAdopter();\r\n  },\r\n  computed: {\r\n    filteredAnimalData() {\r\n      if (!this.searchQuery) {\r\n        return [];\r\n      }\r\n      return this.animalData.filter(item =>\r\n          item.name.toLowerCase().includes(this.searchQuery.toLowerCase())\r\n      );\r\n    },\r\n    filteredAdopterData() {\r\n      if (!this.adopterQuery) {\r\n        return [];\r\n      }\r\n      return this.adopterData.filter(item =>\r\n          item.name.toLowerCase().includes(this.adopterQuery.toLowerCase())\r\n      );\r\n    }\r\n  },\r\n  methods: {\r\n    loadAnimal() {\r\n      this.$request.get('/adopt/selectAnimal').then(res => {\r\n        if (res.code === '200') {\r\n          this.animalData = res.data;\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      }).catch(error => {\r\n        console.error('Request failed', error);\r\n        this.$message.error('Failed to load animal data.');\r\n      });\r\n    },\r\n    loadAdopter() {\r\n      this.$request.get('/adopt/selectAdopter').then(res => {\r\n        if (res.code === '200') {\r\n          this.adopterData = res.data;\r\n          console.log(this.adopterData); // 打印 adopterData 以确认数据正确加载\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      }).catch(error => {\r\n        console.error('Request failed', error);\r\n        this.$message.error('Failed to load adopter data.');\r\n      });\r\n    },\r\n    save() {\r\n      this.$request({\r\n        url: this.form.id ? '/adopt/update' : '/adopt/add',\r\n        method: this.form.id ? 'PUT' : 'POST',\r\n        data: this.form\r\n      }).then(res => {\r\n        if (res.code === '200') {\r\n          this.$message.success('Saved successfully');\r\n          this.load(1);\r\n          this.fromVisible = false;\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      })\r\n    },\r\n    GiveUp(row) {\r\n      this.$confirm('Are you sure you want to give up the adoption? Giving up the adoption means you will no longer be the potential adopter for this animal. If you have any concerns or need assistance, please contact our support team.', 'Confirm', {type: \"warning\"}).then(response => {\r\n        this.form = JSON.parse(JSON.stringify(row));\r\n        this.form.status = 'GiveUp Adoption';\r\n        this.save();\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    handleSelectionChange(rows) {\r\n      this.ids = rows.map(v => v.id);\r\n    },\r\n    delBatch() {\r\n      if (!this.ids.length) {\r\n        this.$message.warning('Please select data');\r\n        return;\r\n      }\r\n      this.$confirm('Are you sure you want to delete these data?', 'Confirm Delete', {type: \"warning\"}).then(response => {\r\n        this.$request.delete('/adopt/delete/batch', {data: this.ids}).then(res => {\r\n          if (res.code === '200') {\r\n            this.$message.success('Operation successful');\r\n            this.load(1);\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        })\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    load(pageNum) {\r\n      if (pageNum) this.pageNum = pageNum;\r\n      this.$request.get('/adopt/selectPage', {\r\n        params: {\r\n          pageNum: this.pageNum,\r\n          pageSize: this.pageSize,\r\n          status: this.status,\r\n          animalId: this.animalId,\r\n          userId: this.adopterId\r\n        }\r\n      }).then(res => {\r\n        this.tableData = res.data?.list;\r\n        this.total = res.data?.total;\r\n      })\r\n    },\r\n    reset() {\r\n      this.status = null;\r\n      this.animalId = null;\r\n      this.adopterId = null;\r\n      this.searchQuery = '';\r\n      this.adopterQuery = '';\r\n      this.load(1);\r\n    },\r\n    handleCurrentChange(pageNum) {\r\n      this.load(pageNum);\r\n    },\r\n    handleSearch() {\r\n      // 在这里可以处理额外的搜索逻辑，例如记录搜索关键词或其他操作\r\n      // 当前示例中没有具体操作，因为过滤逻辑在 computed 属性中\r\n    },\r\n    handleAdopterSearch() {\r\n      // 这里处理额外的收养人搜索逻辑\r\n    },\r\n    selectAnimal(id) {\r\n      this.animalId = id;\r\n      this.searchQuery = this.animalData.find(item => item.id === id).name;\r\n    },\r\n    selectAdopter(id) {\r\n      this.adopterId = id;\r\n      this.adopterQuery = this.adopterData.find(item => item.id === id).name;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.search-results {\r\n  list-style-type: none;\r\n  padding: 0;\r\n  margin: 0;\r\n  border: 1px solid #dcdcdc;\r\n  max-height: 150px;\r\n  overflow-y: auto;\r\n  background: white;\r\n}\r\n\r\n.search-results li {\r\n  padding: 8px;\r\n  cursor: pointer;\r\n}\r\n\r\n.search-results li:hover {\r\n  background: #f0f0f0;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}