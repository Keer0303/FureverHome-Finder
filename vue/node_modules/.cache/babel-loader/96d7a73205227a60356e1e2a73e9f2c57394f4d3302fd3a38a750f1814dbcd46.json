{"ast":null,"code":"export default {\n  name: \"Adopt\",\n  data() {\n    return {\n      tableData: [],\n      pageNum: 1,\n      pageSize: 10,\n      total: 0,\n      animalId: null,\n      adopterId: null,\n      status: null,\n      form: {},\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      ids: [],\n      animalData: [],\n      adopterData: [],\n      searchQuery: '',\n      adopterQuery: '' // 添加收养人搜索输入框的绑定值\n    };\n  },\n\n  created() {\n    this.load(1);\n    this.loadAnimal();\n    this.loadAdopter();\n  },\n  computed: {\n    filteredAnimalData() {\n      if (!this.searchQuery) {\n        return [];\n      }\n      return this.animalData.filter(item => item.name.toLowerCase().includes(this.searchQuery.toLowerCase()));\n    },\n    filteredAdopterData() {\n      if (!this.adopterQuery) {\n        return [];\n      }\n      return this.adopterData.filter(item => item.name.toLowerCase().includes(this.adopterQuery.toLowerCase()));\n    }\n  },\n  methods: {\n    handleAdd() {\n      // Add new data\n      this.form = {}; // Clear form data for new entry\n      this.fromVisible = true; // Open the dialog\n    },\n\n    loadAnimal() {\n      this.$request.get('/adopt/selectAnimal').then(res => {\n        if (res.code === '200') {\n          this.animalData = res.data;\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error('Request failed', error);\n        this.$message.error('Failed to load animal data.');\n      });\n    },\n    loadAdopter() {\n      this.$request.get('/adopt/selectAdopter').then(res => {\n        if (res.code === '200') {\n          this.adopterData = res.data;\n          console.log(this.adopterData); // 打印 adopterData 以确认数据正确加载\n        } else {\n          this.$message.error(res.msg);\n        }\n      }).catch(error => {\n        console.error('Request failed', error);\n        this.$message.error('Failed to load adopter data.');\n      });\n    },\n    save() {\n      this.$request({\n        url: this.form.id ? '/adopt/update' : '/adopt/add',\n        method: this.form.id ? 'PUT' : 'POST',\n        data: this.form\n      }).then(res => {\n        if (res.code === '200') {\n          this.$message.success('Saved successfully');\n          this.load(1);\n          this.fromVisible = false;\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    },\n    GiveUp(row) {\n      this.$confirm('Are you sure you want to give up the adoption? Giving up the adoption means you will no longer be the potential adopter for this animal. If you have any concerns or need assistance, please contact our support team.', 'Confirm', {\n        type: \"warning\"\n      }).then(response => {\n        this.form = JSON.parse(JSON.stringify(row));\n        this.form.status = 'GiveUp Adoption';\n        this.save();\n      }).catch(() => {});\n    },\n    handleSelectionChange(rows) {\n      this.ids = rows.map(v => v.id);\n    },\n    delBatch() {\n      if (!this.ids.length) {\n        this.$message.warning('Please select data');\n        return;\n      }\n      this.$confirm('Are you sure you want to delete these data?', 'Confirm Delete', {\n        type: \"warning\"\n      }).then(response => {\n        this.$request.delete('/adopt/delete/batch', {\n          data: this.ids\n        }).then(res => {\n          if (res.code === '200') {\n            this.$message.success('Operation successful');\n            this.load(1);\n          } else {\n            this.$message.error(res.msg);\n          }\n        });\n      }).catch(() => {});\n    },\n    load(pageNum) {\n      if (pageNum) this.pageNum = pageNum;\n      this.$request.get('/adopt/selectPage', {\n        params: {\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          status: this.status,\n          animalId: this.animalId,\n          userId: this.adopterId\n        }\n      }).then(res => {\n        this.tableData = res.data?.list;\n        this.total = res.data?.total;\n      });\n    },\n    reset() {\n      this.status = null;\n      this.animalId = null;\n      this.adopterId = null;\n      this.searchQuery = '';\n      this.adopterQuery = '';\n      this.load(1);\n    },\n    handleCurrentChange(pageNum) {\n      this.load(pageNum);\n    },\n    handleSearch() {\n      // 在这里可以处理额外的搜索逻辑，例如记录搜索关键词或其他操作\n      // 当前示例中没有具体操作，因为过滤逻辑在 computed 属性中\n    },\n    handleAdopterSearch() {\n      // 这里处理额外的收养人搜索逻辑\n    },\n    selectAnimal(id) {\n      this.animalId = id;\n      this.searchQuery = this.animalData.find(item => item.id === id).name;\n    },\n    selectAdopter(id) {\n      this.adopterId = id;\n      this.adopterQuery = this.adopterData.find(item => item.id === id).name;\n    }\n  }\n};","map":{"version":3,"names":["name","data","tableData","pageNum","pageSize","total","animalId","adopterId","status","form","user","JSON","parse","localStorage","getItem","ids","animalData","adopterData","searchQuery","adopterQuery","created","load","loadAnimal","loadAdopter","computed","filteredAnimalData","filter","item","toLowerCase","includes","filteredAdopterData","methods","handleAdd","fromVisible","$request","get","then","res","code","$message","error","msg","catch","console","log","save","url","id","method","success","GiveUp","row","$confirm","type","response","stringify","handleSelectionChange","rows","map","v","delBatch","length","warning","delete","params","userId","list","reset","handleCurrentChange","handleSearch","handleAdopterSearch","selectAnimal","find","selectAdopter"],"sources":["src/views/manager/Adopt.vue"],"sourcesContent":["<template>\r\n  <div>\r\n\r\n    <div class=\"search\">\r\n      <!-- 搜索框 -->\r\n      <el-input v-model=\"searchQuery\" placeholder=\"Search By Animal Name\" style=\"width: 200px\"  @input=\"handleSearch\"></el-input>\r\n      <ul v-if=\"filteredAnimalData.length > 0\" class=\"search-results\">\r\n        <li v-for=\"item in filteredAnimalData\" :key=\"item.id\" @click=\"selectAnimal(item.id)\">\r\n          {{ item.name }}\r\n        </li>\r\n      </ul>\r\n\r\n      <!-- 收养人搜索框 -->\r\n      <el-input v-model=\"adopterQuery\" placeholder=\"Search By Adopter\" style=\"width: 200px; margin-left: 5px\" @input=\"handleAdopterSearch\" v-if=\"user.role === 'ADMIN'\"></el-input>\r\n      <ul v-if=\"filteredAdopterData.length > 0\" class=\"search-results\">\r\n        <li v-for=\"item in filteredAdopterData\" :key=\"item.id\" @click=\"selectAdopter(item.id)\">\r\n          {{ item.name }}\r\n        </li>\r\n      </ul>\r\n\r\n      <!-- 状态选择框 -->\r\n      <el-select v-model=\"status\" placeholder=\"Search By Status\" style=\"width: 200px; margin-left: 5px\">\r\n        <el-option label=\"Adopted\" value=\"Adopted\"></el-option>\r\n        <el-option label=\"In Process\" value=\"In Process\"></el-option>\r\n<!--        <el-option label=\"GiveUp Adoption\" value=\"GiveUp Adoption\"></el-option>-->\r\n      </el-select>\r\n\r\n      <el-button type=\"info\" plain style=\"margin-left: 10px\" @click=\"load(1)\">Search</el-button>\r\n      <el-button type=\"warning\" plain style=\"margin-left: 10px\" @click=\"reset\">Reset</el-button>\r\n    </div>\r\n\r\n    <div class=\"operation\" v-if=\"user.role !== 'USER'\">\r\n      <el-button type=\"primary\" plain @click=\"handleAdd\">Add New Adopt Record</el-button>\r\n      <el-button type=\"danger\" plain @click=\"delBatch\">Batch Delete</el-button>\r\n    </div>\r\n\r\n    <div class=\"table\">\r\n      <el-table :data=\"tableData\" stripe @selection-change=\"handleSelectionChange\">\r\n        <!-- Selection Column -->\r\n        <el-table-column type=\"selection\" width=\"55\" align=\"center\"></el-table-column>\r\n\r\n        <!-- ID Column -->\r\n        <el-table-column prop=\"id\" label=\"ID\" width=\"80\" align=\"center\" sortable></el-table-column>\r\n\r\n        <!-- Image Column -->\r\n        <el-table-column prop=\"animalImg\" label=\"Image\" show-overflow-tooltip>\r\n          <template v-slot=\"scope\">\r\n            <div style=\"display: flex; align-items: center\">\r\n              <el-image\r\n                  style=\"width: 40px; height: 40px; border-radius: 50%\"\r\n                  v-if=\"scope.row.animalImg\"\r\n                  :src=\"scope.row.animalImg\"\r\n                  :preview-src-list=\"[scope.row.animalImg]\"\r\n              ></el-image>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <!-- Name Column -->\r\n        <el-table-column prop=\"animalName\" label=\"Name\" show-overflow-tooltip></el-table-column>\r\n\r\n        <!-- Adopter Column -->\r\n        <el-table-column prop=\"userName\" label=\"Adopter\" show-overflow-tooltip></el-table-column>\r\n\r\n        <!-- Adopt Time Column -->\r\n        <el-table-column prop=\"time\" label=\"Adopt Time\"></el-table-column>\r\n\r\n        <!-- Adoption Status Column -->\r\n        <el-table-column prop=\"status\" label=\"Adoption Status\"></el-table-column>\r\n\r\n        <!-- Actions Column: Only visible to non-ADMIN users -->\r\n        <el-table-column\r\n            v-if=\"user.role !== 'ADMIN'\"\r\n            label=\"Actions\"\r\n            width=\"180\"\r\n            align=\"center\"\r\n        >\r\n          <template v-slot=\"scope\">\r\n            <el-button\r\n                plain\r\n                type=\"danger\"\r\n                size=\"mini\"\r\n                :disabled=\"scope.row.status === 'GiveUp Adoption'\"\r\n                @click=\"GiveUp(scope.row)\"\r\n            >\r\n              Give Up Adoption\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n\r\n\r\n    <div class=\"pagination\">\r\n        <el-pagination\r\n            background\r\n            @current-change=\"handleCurrentChange\"\r\n            :current-page=\"pageNum\"\r\n            :page-sizes=\"[5, 10, 20]\"\r\n            :page-size=\"pageSize\"\r\n            layout=\"total, prev, pager, next\"\r\n            :total=\"total\">\r\n        </el-pagination>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Adopt\",\r\n  data() {\r\n    return {\r\n      tableData: [],\r\n      pageNum: 1,\r\n      pageSize: 10,\r\n      total: 0,\r\n      animalId: null,\r\n      adopterId: null,\r\n      status: null,\r\n      form: {},\r\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\r\n      ids: [],\r\n      animalData: [],\r\n      adopterData: [],\r\n      searchQuery: '',\r\n      adopterQuery: ''  // 添加收养人搜索输入框的绑定值\r\n    }\r\n  },\r\n  created() {\r\n    this.load(1);\r\n    this.loadAnimal();\r\n    this.loadAdopter();\r\n  },\r\n  computed: {\r\n    filteredAnimalData() {\r\n      if (!this.searchQuery) {\r\n        return [];\r\n      }\r\n      return this.animalData.filter(item =>\r\n          item.name.toLowerCase().includes(this.searchQuery.toLowerCase())\r\n      );\r\n    },\r\n    filteredAdopterData() {\r\n      if (!this.adopterQuery) {\r\n        return [];\r\n      }\r\n      return this.adopterData.filter(item =>\r\n          item.name.toLowerCase().includes(this.adopterQuery.toLowerCase())\r\n      );\r\n    }\r\n  },\r\n  methods: {\r\n    handleAdd() {   // Add new data\r\n      this.form = {}  // Clear form data for new entry\r\n      this.fromVisible = true   // Open the dialog\r\n    },\r\n\r\n    loadAnimal() {\r\n      this.$request.get('/adopt/selectAnimal').then(res => {\r\n        if (res.code === '200') {\r\n          this.animalData = res.data;\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      }).catch(error => {\r\n        console.error('Request failed', error);\r\n        this.$message.error('Failed to load animal data.');\r\n      });\r\n    },\r\n    loadAdopter() {\r\n      this.$request.get('/adopt/selectAdopter').then(res => {\r\n        if (res.code === '200') {\r\n          this.adopterData = res.data;\r\n          console.log(this.adopterData); // 打印 adopterData 以确认数据正确加载\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      }).catch(error => {\r\n        console.error('Request failed', error);\r\n        this.$message.error('Failed to load adopter data.');\r\n      });\r\n    },\r\n    save() {\r\n      this.$request({\r\n        url: this.form.id ? '/adopt/update' : '/adopt/add',\r\n        method: this.form.id ? 'PUT' : 'POST',\r\n        data: this.form\r\n      }).then(res => {\r\n        if (res.code === '200') {\r\n          this.$message.success('Saved successfully');\r\n          this.load(1);\r\n          this.fromVisible = false;\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      })\r\n    },\r\n    GiveUp(row) {\r\n      this.$confirm('Are you sure you want to give up the adoption? Giving up the adoption means you will no longer be the potential adopter for this animal. If you have any concerns or need assistance, please contact our support team.', 'Confirm', {type: \"warning\"}).then(response => {\r\n        this.form = JSON.parse(JSON.stringify(row));\r\n        this.form.status = 'GiveUp Adoption';\r\n        this.save();\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    handleSelectionChange(rows) {\r\n      this.ids = rows.map(v => v.id);\r\n    },\r\n    delBatch() {\r\n      if (!this.ids.length) {\r\n        this.$message.warning('Please select data');\r\n        return;\r\n      }\r\n      this.$confirm('Are you sure you want to delete these data?', 'Confirm Delete', {type: \"warning\"}).then(response => {\r\n        this.$request.delete('/adopt/delete/batch', {data: this.ids}).then(res => {\r\n          if (res.code === '200') {\r\n            this.$message.success('Operation successful');\r\n            this.load(1);\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        })\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    load(pageNum) {\r\n      if (pageNum) this.pageNum = pageNum;\r\n      this.$request.get('/adopt/selectPage', {\r\n        params: {\r\n          pageNum: this.pageNum,\r\n          pageSize: this.pageSize,\r\n          status: this.status,\r\n          animalId: this.animalId,\r\n          userId: this.adopterId\r\n        }\r\n      }).then(res => {\r\n        this.tableData = res.data?.list;\r\n        this.total = res.data?.total;\r\n      })\r\n    },\r\n    reset() {\r\n      this.status = null;\r\n      this.animalId = null;\r\n      this.adopterId = null;\r\n      this.searchQuery = '';\r\n      this.adopterQuery = '';\r\n      this.load(1);\r\n    },\r\n    handleCurrentChange(pageNum) {\r\n      this.load(pageNum);\r\n    },\r\n    handleSearch() {\r\n      // 在这里可以处理额外的搜索逻辑，例如记录搜索关键词或其他操作\r\n      // 当前示例中没有具体操作，因为过滤逻辑在 computed 属性中\r\n    },\r\n    handleAdopterSearch() {\r\n      // 这里处理额外的收养人搜索逻辑\r\n    },\r\n    selectAnimal(id) {\r\n      this.animalId = id;\r\n      this.searchQuery = this.animalData.find(item => item.id === id).name;\r\n    },\r\n    selectAdopter(id) {\r\n      this.adopterId = id;\r\n      this.adopterQuery = this.adopterData.find(item => item.id === id).name;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.search-results {\r\n  list-style-type: none;\r\n  padding: 0;\r\n  margin: 0;\r\n  border: 1px solid #dcdcdc;\r\n  max-height: 150px;\r\n  overflow-y: auto;\r\n  background: white;\r\n}\r\n\r\n.search-results li {\r\n  padding: 8px;\r\n  cursor: pointer;\r\n}\r\n\r\n.search-results li:hover {\r\n  background: #f0f0f0;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}